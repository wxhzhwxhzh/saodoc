---
id: intro7
permalink: /js/evaluate
title: 'ğŸ”µ document.evalute'
---

# document.evaluate è¯¦ç»†è®²è§£

`document.evaluate` æ˜¯ DOM API ä¸­ç”¨äºæ‰§è¡Œ XPath è¡¨è¾¾å¼çš„æ–¹æ³•,å®ƒæä¾›äº†ä¸€ç§å¼ºå¤§çš„æ–¹å¼æ¥æŸ¥è¯¢å’Œå®šä½ XML/HTML æ–‡æ¡£ä¸­çš„èŠ‚ç‚¹ã€‚

## åŸºæœ¬è¯­æ³•

```javascript
let result = document.evaluate(
  xpathExpression,    // XPath æŸ¥è¯¢å­—ç¬¦ä¸²
  contextNode,        // æŸ¥è¯¢çš„ä¸Šä¸‹æ–‡èŠ‚ç‚¹
  namespaceResolver,  // å‘½åç©ºé—´è§£æå™¨(å¯é€‰)
  resultType,         // è¿”å›ç»“æœçš„ç±»å‹
  result              // é‡ç”¨çš„ç»“æœå¯¹è±¡(å¯é€‰)
);
```

## å‚æ•°è¯¦è§£

### 1. xpathExpression (å¿…éœ€)
XPath æŸ¥è¯¢è¡¨è¾¾å¼å­—ç¬¦ä¸²,ä¾‹å¦‚:
- `"//div[@class='content']"` - æŸ¥æ‰¾æ‰€æœ‰ class ä¸º content çš„ div
- `"//a/@href"` - è·å–æ‰€æœ‰é“¾æ¥çš„ href å±æ€§
- `"count(//p)"` - è®¡ç®—æ®µè½æ•°é‡

### 2. contextNode (å¿…éœ€)
æŒ‡å®šæŸ¥è¯¢çš„ä¸Šä¸‹æ–‡èŠ‚ç‚¹,é€šå¸¸æ˜¯:
- `document` - ä»æ•´ä¸ªæ–‡æ¡£å¼€å§‹
- æŸä¸ªå…·ä½“çš„å…ƒç´ èŠ‚ç‚¹ - ä»è¯¥èŠ‚ç‚¹å¼€å§‹æŸ¥è¯¢

### 3. namespaceResolver (å¯é€‰)
ç”¨äºè§£æ XPath è¡¨è¾¾å¼ä¸­çš„å‘½åç©ºé—´å‰ç¼€ã€‚é€šå¸¸ä¼  `null`,é™¤éå¤„ç†å¸¦å‘½åç©ºé—´çš„ XMLã€‚

### 4. resultType (å¿…éœ€)
æŒ‡å®šè¿”å›ç»“æœçš„ç±»å‹,å¸¸ç”¨çš„ç±»å‹å¸¸é‡:

```javascript
// æ•°å­—ç±»å‹
XPathResult.NUMBER_TYPE = 1

// å­—ç¬¦ä¸²ç±»å‹
XPathResult.STRING_TYPE = 2

// å¸ƒå°”ç±»å‹
XPathResult.BOOLEAN_TYPE = 3

// å•ä¸ªèŠ‚ç‚¹
XPathResult.FIRST_ORDERED_NODE_TYPE = 9

// æ— åºèŠ‚ç‚¹è¿­ä»£å™¨
XPathResult.UNORDERED_NODE_ITERATOR_TYPE = 4

// æœ‰åºèŠ‚ç‚¹è¿­ä»£å™¨
XPathResult.ORDERED_NODE_ITERATOR_TYPE = 5

// æ— åºèŠ‚ç‚¹å¿«ç…§
XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE = 6

// æœ‰åºèŠ‚ç‚¹å¿«ç…§
XPathResult.ORDERED_NODE_SNAPSHOT_TYPE = 7

// ä»»æ„å•èŠ‚ç‚¹
XPathResult.ANY_UNORDERED_NODE_TYPE = 8

// è‡ªåŠ¨åˆ¤æ–­æœ€åˆé€‚çš„ç±»å‹
XPathResult.ANY_TYPE = 0
```

### 5. result (å¯é€‰)
ä¸€ä¸ªç°æœ‰çš„ XPathResult å¯¹è±¡,ç”¨äºé‡ç”¨ä»¥æé«˜æ€§èƒ½ã€‚é€šå¸¸ä¼  `null`ã€‚

## å®é™…åº”ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: è·å–æ‰€æœ‰åŒ¹é…çš„èŠ‚ç‚¹(è¿­ä»£å™¨æ–¹å¼)

```javascript
// æŸ¥æ‰¾æ‰€æœ‰ class åŒ…å« 'item' çš„ div
let iterator = document.evaluate(
  "//div[contains(@class, 'item')]",
  document,
  null,
  XPathResult.ORDERED_NODE_ITERATOR_TYPE,
  null
);

let node;
let nodes = [];
while (node = iterator.iterateNext()) {
  nodes.push(node);
  console.log(node.textContent);
}
```

### ç¤ºä¾‹ 2: è·å–èŠ‚ç‚¹å¿«ç…§

```javascript
// å¿«ç…§æ–¹å¼ - ä¸å— DOM å˜åŒ–å½±å“
let snapshot = document.evaluate(
  "//a[@href]",
  document,
  null,
  XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,
  null
);

for (let i = 0; i < snapshot.snapshotLength; i++) {
  let link = snapshot.snapshotItem(i);
  console.log(link.href);
}
```

### ç¤ºä¾‹ 3: è·å–å•ä¸ªèŠ‚ç‚¹

```javascript
// è·å–ç¬¬ä¸€ä¸ªåŒ¹é…çš„ h1 å…ƒç´ 
let result = document.evaluate(
  "//h1",
  document,
  null,
  XPathResult.FIRST_ORDERED_NODE_TYPE,
  null
);

if (result.singleNodeValue) {
  console.log(result.singleNodeValue.textContent);
}
```

### ç¤ºä¾‹ 4: è·å–æ•°å€¼ç»“æœ

```javascript
// è®¡ç®—é¡µé¢ä¸­æ®µè½çš„æ•°é‡
let count = document.evaluate(
  "count(//p)",
  document,
  null,
  XPathResult.NUMBER_TYPE,
  null
);

console.log("æ®µè½æ•°é‡:", count.numberValue);
```

### ç¤ºä¾‹ 5: è·å–å­—ç¬¦ä¸²ç»“æœ

```javascript
// è·å–ç¬¬ä¸€ä¸ª h1 çš„æ–‡æœ¬å†…å®¹
let text = document.evaluate(
  "string(//h1)",
  document,
  null,
  XPathResult.STRING_TYPE,
  null
);

console.log("æ ‡é¢˜:", text.stringValue);
```

## è¿­ä»£å™¨ vs å¿«ç…§çš„åŒºåˆ«

**è¿­ä»£å™¨ (Iterator)**
- åŠ¨æ€çš„,åæ˜  DOM çš„å®æ—¶çŠ¶æ€
- å¦‚æœåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ DOM å‘ç”Ÿå˜åŒ–,å¯èƒ½æŠ›å‡ºå¼‚å¸¸
- å†…å­˜æ•ˆç‡æ›´é«˜

**å¿«ç…§ (Snapshot)**
- é™æ€çš„,è·å–æ—¶çš„ DOM çŠ¶æ€å¿«ç…§
- DOM å˜åŒ–ä¸å½±å“å¿«ç…§å†…å®¹
- å¯é€šè¿‡ç´¢å¼•éšæœºè®¿é—®
- å ç”¨æ›´å¤šå†…å­˜

## å¸¸ç”¨ XPath è¡¨è¾¾å¼ç¤ºä¾‹

```javascript
// 1. æŒ‰ ID æŸ¥æ‰¾
"//div[@id='myId']"

// 2. æŒ‰ class æŸ¥æ‰¾
"//div[@class='myClass']"

// 3. æŒ‰å±æ€§æŸ¥æ‰¾
"//input[@type='text']"

// 4. åŒ…å«æŸä¸ª class
"//div[contains(@class, 'partial')]"

// 5. æŸ¥æ‰¾æ–‡æœ¬å†…å®¹
"//p[text()='Hello World']"
"//p[contains(text(), 'Hello')]"

// 6. çˆ¶å­å…³ç³»
"//div[@class='parent']/p"  // ç›´æ¥å­å…ƒç´ 
"//div[@class='parent']//p" // æ‰€æœ‰åä»£å…ƒç´ 

// 7. å…„å¼Ÿå…ƒç´ 
"//h1/following-sibling::p"  // åé¢çš„å…„å¼Ÿ p
"//h1/preceding-sibling::div" // å‰é¢çš„å…„å¼Ÿ div

// 8. ä½ç½®é€‰æ‹©
"//li[1]"        // ç¬¬ä¸€ä¸ª li
"//li[last()]"   // æœ€åä¸€ä¸ª li
"//li[position() < 3]" // å‰ä¸¤ä¸ª li

// 9. å¤šæ¡ä»¶
"//div[@class='item' and @data-id='123']"
"//a[@href or @name]"
```

## ä¼˜ç¼ºç‚¹

**ä¼˜ç‚¹:**
- å¼ºå¤§çµæ´»çš„æŸ¥è¯¢èƒ½åŠ›
- æ”¯æŒå¤æ‚çš„èŠ‚ç‚¹é€‰æ‹©é€»è¾‘
- æ ‡å‡† W3C API

**ç¼ºç‚¹:**
- æ¯” `querySelector` è¯­æ³•æ›´å¤æ‚
- æ€§èƒ½é€šå¸¸ä¸å¦‚åŸç”Ÿ CSS é€‰æ‹©å™¨
- XPath è¡¨è¾¾å¼å¯è¯»æ€§è¾ƒå·®
- æµè§ˆå™¨å…¼å®¹æ€§éœ€è¦æ³¨æ„(IE æœ‰é™æ”¯æŒ)

## ç°ä»£æ›¿ä»£æ–¹æ¡ˆ

åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹,æ¨èä½¿ç”¨:
- `querySelector` / `querySelectorAll` - ä½¿ç”¨ CSS é€‰æ‹©å™¨
- `getElementById` / `getElementsByClassName` ç­‰åŸç”Ÿæ–¹æ³•

ä½†åœ¨ä»¥ä¸‹åœºæ™¯,`document.evaluate` ä»ç„¶æœ‰ç”¨:
- éœ€è¦ä½¿ç”¨ XPath ç‰¹æœ‰çš„åŠŸèƒ½(å¦‚æ–‡æœ¬åŒ¹é…ã€è½´æŸ¥è¯¢)
- å¤„ç† XML æ–‡æ¡£
- éœ€è¦è®¡ç®—èŠ‚ç‚¹æ•°é‡ç­‰èšåˆæ“ä½œ
- ä¸ä½¿ç”¨ XPath çš„ç³»ç»Ÿé›†æˆ